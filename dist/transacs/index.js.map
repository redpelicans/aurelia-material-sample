{"version":3,"sources":["transacs/index.js"],"names":[],"mappings":"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","file":"transacs/index.js","sourcesContent":["import {computedFrom} from 'aurelia-framework';\nimport _ from 'lodash';\nimport moment from 'moment';\n\nexport function makeNode(obj){\n  if(!obj)return;\n  switch(obj.type){\n    case 'transac':\n      return new Transac(obj);\n    case 'event':\n      return new Event(obj);\n    case 'message':\n      return new Message(obj);\n  }\n}\n\nclass Node {\n  constructor({id, label, transacId, parentId, type, createdAt} = {}){\n    this.id = id;\n    this.createdAt = moment(createdAt);\n    this.transacId = transacId;\n    if(parentId) this.parentId = parentId;\n    this.type = type;\n    this.label = label;\n    this.status = 'ok';\n  }\n\n  isTransac(){\n    return this.type === 'transac';\n  }\n\n  isEvent(){\n    return this.type === 'event';\n  }\n\n  isMessage(){\n    return this.type === 'message';\n  }\n\n\n  get children(){\n    return this._children || [];\n  }\n\n  addChild(node){\n    if(!this._children) this._children = [];\n    this._children.push(node);\n    node.parent = this;\n    this.updateStates(node);\n    return this;\n  }\n\n  isLeaf(){\n    return !this.length;\n  }\n\n  [Symbol.iterator](){\n    let done = {}, node, remainingNodes = [this];\n    function iterate(nodes){\n      let child = nodes[0];\n      if(!child) return [null, []];\n      if(child.isLeaf() || done[child.id]) return [child, nodes.slice(1)];\n      nodes.splice(0, 0, ...child.children);\n      done[child.id] = true;\n      return iterate(nodes);\n    }\n\n    return {\n      [Symbol.iterator](){\n        return this;\n      },\n      next(){\n        [node, remainingNodes] =  iterate(remainingNodes);\n        if(node)return {value: node};\n        else return {done: true};\n      }\n    }\n  }\n\n\n  get length(){\n    return this.children.length;\n  }\n\n  get lastChild(){\n    return this.children && this.children[this.length - 1];\n  }\n\n  get lastMessage(){\n    // BUG with Babel\n    //let nodes = _.filter([...this], node => node.isMessage());\n    let nodes = [];\n    for (let node of this) if(node.isMessage()) nodes.push(node); \n    return nodes[nodes.length-1];\n  }\n\n  get lastMessageTime(){\n    let lastMessage = this.lastMessage;\n    return lastMessage && lastMessage.createdAt;\n  }\n\n  get transac(){\n    if(!this.parent)return this;\n    return this.parent.transac;\n  }\n\n}\n\nexport class Transac extends Node {\n\n  constructor(options){\n    super(options);\n    if(options.valueDate) this.valueDate = moment(options.valueDate, \"DD/MM/YYYY\");\n    _.extend(this, _.pick(options, 'server', 'user', 'processId'));\n    this.isRunning = true;\n    this.status = 'ok';\n    this.isLocked = options.locked;\n    this.isCompound = options.compound;\n  }\n\n  updateStates(node){\n    if(node.isMessage()){\n      if(node.level === 'commit' || node.level === 'abort') this.isRunning = false;\n      this.delay = node.createdAt - this.createdAt;\n      if(node.status === 'error') this.status =  'error';\n      else if(this.status != 'error' && node.level === 'warning') this.status =  'warning';\n    }\n    if(this.parent) this.parent.updateStates(node);\n  }\n\n  @computedFrom('status')\n  get statusIcon(){\n    switch(this.status){\n      case 'ok':\n        return 'glyphicon glyphicon-chevron-down green-icon';\n      case 'warning':\n        return 'glyphicon glyphicon-warning-sign orange-icon';\n      case 'error':\n        return 'glyphicon glyphicon-minus-sign red-icon';\n    }\n  }\n \n  @computedFrom('isRunning')\n  get runningIcon(){\n    return (this.isRunning ? 'glyphicon glyphicon-time green-icon' : 'glyphicon glyphicon-remove green-icon');\n  }\n\n  @computedFrom('isCompound')\n  get compoundIcon(){\n    if(this.isCompound) return 'glyphicon glyphicon-th-large blue-icon';\n  }\n\n  @computedFrom('isLocked')\n  get lockIcon(){\n    if(this.isLocked) return 'glyphicon glyphicon-lock gray-icon';\n  }\n\n}\n\nexport class Event extends Node{\n  constructor(options){\n    super(options);\n  }\n\n  updateStates(node){\n    if(node.isMessage()){\n      if(node.status === 'error') this.status =  'error';\n      else if(this.status != 'error' && node.level === 'warning') this.status =  'warning';\n    }\n    if(this.parent) this.parent.updateStates(node);\n  }\n}\n\nexport class Message extends Node{\n  constructor(options){\n    super(options);\n    this.level = options.level;\n    if(this.level === 'abort' || this.level === 'error') this.status =  'error';\n    else this.status =  this.level;\n  }\n}\n\n\n\n"],"sourceRoot":"/source/"}